
IF OBJECT_ID ('TempDB..#ClosedStores') IS NOT NULL  
DROP TABLE #ClosedStores
CREATE TABLE #ClosedStores (STORE INT, STORENAME VARCHAR(60),MAXPERIOD DATE, SSTATUS NVARCHAR (20)) 

INSERT INTO #ClosedStores
SELECT STORE,SNAME, MAX (PERIOD), SSTATUS
FROM MCDHKDL.DATALOAD.DLPMIXHISTORY
JOIN MCDHK.DBO.STORES ON SSTORE = STORE
GROUP BY STORE, SNAME, SSTATUS
ORDER BY MAX (PERIOD) 

--If store is here there is a big chance is closed. Check with client to confirm---
SELECT * FROM #ClosedStores
WHERE SSTATUS LIKE '%OPEN%'
AND MAXPERIOD <'2017-01-31' --Entered last day of data
order by maxperiod 
